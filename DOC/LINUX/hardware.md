# Hardware / Machine Info

Finding out more about the hardware / operating system is important: a) when installing drivers for a new machine, and b) when running installation scripts that are hardware / os dependent.

uname -m and -p   	 	(Processor)  x86_64  for 64 bit system, i686 for 32 bit system.
uname -r 	 	 	Kernel Release  (Ubuntu/Debian/..)
uname -v	 	 	Kernel Version  ( version of kernel)
uname -a 	 	 	processor and hostname
cat /etc/debian_version    	 displays the current debian version.
sudo lshw   		List Hardware
sudo lshw -short
hwinfo --short
cat /proc/version
cat /proc/cpuinfo


DISK TOOLS
cat /proc/partitions
sudo blkid -o list 	alle partition, ihre UUID und filesystem type
sudo fdisk -l    		list partition with fdisk (fdisk can also modify)
lsblk  			shows all disks and partitions
inxi -D    		Disk (HardDisk)
inxi -P   Partitions
ls -l /dev/disk/by-uuid
ls /dev/disk/by-partuuid -alfg
cat /proc/scsi/scsi


lsblk delete all partitions with “sudo gparted”
cat /proc/cpuinfo   
lscpu   shows the architecture



inxi super tool to get all kind of hardware related info
Inxi is a 10K line mega bash script that fetches hardware details from multiple different sources and commands on the system, and generates a beautiful looking report that non technical users can read easily.
inxi 	  cpu, memory, uptime, hdd info
nixi -F    Full (all of the below)
inxi -C    CPU
inxi -N   Network card 
inxi -I	 Info
inxi -A   Audiocard
inxi -G Graphics Card
inxi -S   System
inxi -s   Sensors
inxi -M Machine
write ISO image to a stick/usb disk

lsblk
sudo fdisk -l   lists disks and partitions


sudo gparted    remove all partitions from USB drive

write image to disk
sudo dd bs=8M of=/dev/sdb  if=./manjaro-kde-0.8.13.1-x86_64.iso 
sudo dd if=~/Desktop/ubuntu.iso of=/dev/sdx bs=1M; sync
sudo dd if=guix-system-install-1.3.0.x86_64-linux.iso of=/dev/sdc status=progress
sync
The command sync flushes all output buffers to the disk(s). When the sync command returns, the data has been fully written.


disk speed test
change to a directory that you want to  test.
write: 
dd if=/dev/zero of=./largefile bs=1M count=1024
read:
sudo sh -c "sync && echo 3 > /proc/sys/vm/drop_caches"
dd if=./largefile of=/dev/null bs=4k
rm ./largefile

partition editors


https://www.youtube.com/watch?v=ELEVo6SbYl0

DISK PARTITION 

BIOS systems will use MBR (MSDOS Partition Table)
UEFI systems will use GPT

lsblk 
lsblk -f    
sudo fdisk -l  
df   Df is not a partitioning utility, but prints out details about only mounted file systems. The list generated by df even includes file systems that are not real disk partitions.


cfdisk - interactive partition editor
parted  - partition editor


Hdparm            ATA
Sdparm            SCSI


sudo sdparm -l -a /dev/sdX
sudo hdparm --dco-identify /dev/sda
real size of the drive (max sectors)

HPA (Host Protected Area) orand DCO (Drive Configuration Overlay)
Harddrive - wipe out "hidden areas" like HPA and DCO
hdparm --yes-i-know-what-i-am-doing --dco-restore /dev/sdc

sudo hdparm -N /dev/sdX to check whether HPA is enabled or disabled.
sudo hdparm -g /dev/sdX to check number of sectors.
hdparm --dco-identify /dev/sda
disk_stat /dev/hdb
sudo hdparm -Np<MAX SECTORS> /dev/sdX to disable HPA.
sudo hdparm --yes-i-know-what-i-am-doing --dco-identify /dev/sdX
sudo hdparm --yes-i-know-what-i-am-doing --dco-restore /dev/sdX



parted --align optimal --script /dev/sdc \
    mklabel gpt \
    mkpart primary 0% 100%


parted --align optimal --script /dev/sdc \
    mklabel gpt \
    mkpart primary ext4 0% 100%


parted --align optimal --script /dev/sdc \
    mklabel gpt \
    mkpart primary 1000MiB 90% \
    mkpart extended 90% 100% 

--align option lets parted find the partition's optimal starting and stopping point.
the mklabel command creates a partition table (called a disk label) on the device
mkpart primary
Mkpart extended



HPA
HPA (Host Protected Area) is a 'feature' (read: curse) of certain motherboards that is supposed to help recover from a corrupted BIOS. HPA goes by many names in the BIOS settings.  It has been called: Save a Copy of BIOS to HDD
BIOS Backup, Backup BIOS to HDD, Xpress BIOS Rescue
sudo hdparm -N /dev/sdc
Intel PTT Plattform Trust Technology
Ob ignore_hpa aktiviert ist, stellt man mit folgendem Kommando fest:

cat /sys/module/libata/parameters/ignore_hpa
Wird hier "1" ausgegeben, wird HPA automatisch deaktiviert sobald eine SSD mit HPA angeschlossen wird.




udisksctl status
https://lists.debian.org/debian-user/2015/08/msg00125.html

sg_format --resize --count=0x74706DB0 /dev/sdb

# sg_format --format --count=0x74706DB0 /dev/sdb










sudo cryptsetup luksFormat --type luks2 /dev/sdb2
Create luks partition
sudo cryptsetup luksDump /dev/sdc
Check the key
sudo cryptsetup luksUUID /dev/sdc
Luks id
sudo cryptsetup luksOpen /dev/sdb2 red2
sudo cryptsetup -v status red2
ls -l /dev/mapper/red2

sdc           8:32   1   1,9T  0 disk  
└─sdc1        8:33   1   1,9T  0 part  
  └─red2    254:0    0   1,9T  0 crypt 



create a mapping for the current session
Check mapping status
Check the mapper
sudo dd if=/dev/zero of=/dev/mapper/red2
sudo mkfs.ext4 /dev/mapper/red2 
sudo fsck -Vt ext4 /dev/mapper/red2         this shows errors!


sudo unmount /dev/sda10
sudo fsck /dev/mapper/red2


CLEAR PARTITION
FORMAT PARTITION
sudo mkdir /home/florian/drives/red2
sudo chown florian:florian /home/florian/drives/red2
sudo chattr +i /home/florian/drives/red2

SHOW MOUNTED DRIVES
cat /proc/mounts
sudo mount /dev/mapper/red2  /home/florian/drives/red2
sudo mount /dev/mapper/red2 /run/media/florian/red2



MAKE SURE NO FILESYSTEM WHEN NOT MOUNTED 
umount /dev/mapper/red2
cryptsetup luksClose red2





luksid


KESU


Red1
2T


empty
Red2
2T
luksid
E9f8af9d-ef79-4775-b902-f8864096f8d9

Filesystem id
26a0d4ed-de73-4ee5-b6e8-73f525627743
empty
Red3
2T


Backup 2021 09







